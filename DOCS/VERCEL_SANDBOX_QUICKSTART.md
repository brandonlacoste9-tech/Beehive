# Vercel Sandbox Quick Start Guide

## üöÄ Getting Started in 5 Minutes

This guide will help you get Vercel Sandbox up and running quickly in the AdGenXAI project.

## Prerequisites

- Vercel CLI installed: `npm i -g vercel`
- A Vercel account
- Node.js 18+

## Step 1: Link Your Project (1 minute)

```bash
# From the project root
vercel link
```

Follow the prompts to link to your Vercel project.

## Step 2: Get Authentication Token (30 seconds)

```bash
# Pull environment variables (includes OIDC token)
vercel env pull
```

This creates a `.env.local` file with your authentication token.

**Note**: The token expires after 12 hours. Re-run `vercel env pull` when it expires.

## Step 3: Run Your First Sandbox (3 minutes)

```bash
# Run the Next.js development server example
node --env-file .env.local --experimental-strip-types ./examples/sandbox/next-dev.ts
```

This will:
1. Create a sandbox
2. Clone a Next.js example repository
3. Install dependencies
4. Start a development server
5. Open the sandbox URL in your browser

## Using the Sandbox Utilities

### Create a Simple Sandbox

```typescript
import { createSandbox, runSandboxCommand, getSandboxUrl } from '@/lib/sandbox';

const sandbox = await createSandbox({
  sourceUrl: 'https://github.com/yourorg/repo.git',
  vcpus: 4,
  timeout: '10m',
  ports: [3000],
});

console.log('Sandbox created!');
```

### Run Commands

```typescript
// Install dependencies
await runSandboxCommand(sandbox, {
  cmd: 'npm',
  args: ['install'],
  stdout: process.stdout,
  stderr: process.stderr,
});

// Start your app
await runSandboxCommand(sandbox, {
  cmd: 'npm',
  args: ['start'],
  detached: true,
});
```

### Get the Public URL

```typescript
const url = getSandboxUrl(sandbox, 3000);
console.log(`Your app is running at: ${url}`);
```

### Stop the Sandbox

```typescript
await stopSandbox(sandbox);
console.log('Sandbox stopped');
```

## Common Use Cases

### 1. Test AI-Generated Code

```typescript
import { createSandbox, runSandboxCommand } from '@/lib/sandbox';

async function testAICode(repoUrl: string) {
  const sandbox = await createSandbox({
    sourceUrl: repoUrl,
    timeout: '5m',
  });

  await runSandboxCommand(sandbox, {
    cmd: 'npm',
    args: ['test'],
    stdout: process.stdout,
  });

  return 'Tests passed!';
}
```

### 2. Create Preview Environment

```typescript
async function createPreview(campaignRepo: string) {
  const sandbox = await createSandbox({
    sourceUrl: campaignRepo,
    timeout: '30m',
    ports: [3000],
  });

  await runSandboxCommand(sandbox, {
    cmd: 'npm',
    args: ['run', 'build'],
  });

  await runSandboxCommand(sandbox, {
    cmd: 'npm',
    args: ['start'],
    detached: true,
  });

  return getSandboxUrl(sandbox, 3000);
}
```

### 3. Install Additional Packages

```typescript
import { installPackages } from '@/lib/sandbox';

await installPackages(sandbox, ['git', 'curl', 'vim']);
```

## Environment Variables

### Using OIDC Token (Recommended)

```bash
# .env.local
VERCEL_OIDC_TOKEN=<auto-generated-by-vercel-cli>
```

### Using Access Token (Alternative)

```bash
# .env.local
VERCEL_TEAM_ID=team_xxxxx
VERCEL_PROJECT_ID=prj_xxxxx
VERCEL_TOKEN=your_access_token
```

Then in code:

```typescript
const sandbox = await createSandbox({
  sourceUrl: 'https://github.com/repo.git',
  teamId: process.env.VERCEL_TEAM_ID,
  projectId: process.env.VERCEL_PROJECT_ID,
  token: process.env.VERCEL_TOKEN,
});
```

## Resource Limits

| Plan | Max Timeout | vCPUs | Memory per vCPU |
|------|-------------|-------|-----------------|
| Hobby | 45 minutes | 1-4 | 2 GB |
| Pro | 5 hours | 1-4 | 2 GB |
| Enterprise | 5 hours | 1-4+ | 2 GB |

## Best Practices

### ‚úÖ DO

- Set appropriate timeouts for your use case
- Stream output to stdout/stderr for long-running commands
- Stop sandboxes when done to save costs
- Use 2 vCPUs for simple tasks, 4 for builds
- Handle errors and check exit codes

### ‚ùå DON'T

- Leave sandboxes running idle
- Set unnecessarily long timeouts
- Over-allocate vCPUs
- Forget to handle command failures
- Store sensitive data in sandboxes

## Troubleshooting

### Token Expired

```bash
# Solution: Pull fresh token
vercel env pull
```

### Sandbox Timeout

```typescript
// Solution: Increase timeout
const sandbox = await createSandbox({
  timeout: '20m', // Increase from default 5m
});
```

### Command Failed

```typescript
// Solution: Check exit code
const result = await runSandboxCommand(sandbox, {...});
if (result.exitCode !== 0) {
  console.error('Command failed!');
}
```

### Port Already in Use

```typescript
// Solution: Use different ports
const sandbox = await createSandbox({
  ports: [3001, 8080], // Instead of default 3000
});
```

## Examples

All examples are in `examples/sandbox/`:

- **next-dev.ts** - Run Next.js dev server
- **python-example.ts** - Run Python application
- **install-packages.ts** - Install system packages
- **using-helpers.ts** - Use utility functions

Run any example:

```bash
node --env-file .env.local --experimental-strip-types ./examples/sandbox/[example-name].ts
```

## Integration with AdGenXAI

### API Route Example

```typescript
// app/api/sandbox/create/route.ts
import { NextResponse } from 'next/server';
import { createSandbox } from '@/lib/sandbox';

export async function POST(req: Request) {
  const { sourceUrl } = await req.json();

  const sandbox = await createSandbox({
    sourceUrl,
    timeout: '10m',
  });

  return NextResponse.json({
    url: sandbox.domain(3000),
  });
}
```

## Monitoring

### View Active Sandboxes

1. Go to [Vercel Dashboard](https://vercel.com)
2. Select your project
3. Click **Observability** tab
4. Click **Sandboxes** in sidebar

### Track Usage

Go to **Usage** tab to monitor compute time and costs.

## Additional Resources

- üìñ [Full Documentation](../DOCS/VERCEL_SANDBOX.md)
- üìù [Example Code](../examples/sandbox/)
- üîß [Utility Functions](../lib/sandbox.ts)
- üåê [Vercel Sandbox Docs](https://vercel.com/docs/workflow-collaboration/vercel-sandbox)

## Need Help?

- Check the [Vercel Sandbox documentation](https://vercel.com/docs/workflow-collaboration/vercel-sandbox)
- Review the examples in `examples/sandbox/`
- Open an issue on [GitHub](https://github.com/brandonlacoste9-tech/Beehive/issues)
- Email support@adgenxai.pro

---

**Ready to build something awesome? Start with the examples!** üöÄ
