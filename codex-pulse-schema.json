{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Codex Pulse Accessibility Report",
  "description": "Schema for Codex Pulse accessibility testing artifacts generated from Playwright + axe-core runs",
  "type": "object",
  "required": ["version", "timestamp", "metadata", "summary", "violations"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Version of the Codex Pulse schema",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of when the test was run",
      "format": "date-time"
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the test run",
      "required": ["repository", "commit", "branch", "runId"],
      "properties": {
        "repository": {
          "type": "string",
          "description": "Repository name in owner/repo format"
        },
        "commit": {
          "type": "string",
          "description": "Git commit SHA"
        },
        "branch": {
          "type": "string",
          "description": "Git branch name"
        },
        "pullRequest": {
          "type": "number",
          "description": "Pull request number (if applicable)"
        },
        "runId": {
          "type": "string",
          "description": "GitHub Actions run ID"
        },
        "runNumber": {
          "type": "number",
          "description": "GitHub Actions run number"
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Summary statistics of accessibility violations",
      "required": ["totalViolations", "totalPages", "criticalCount", "seriousCount", "moderateCount", "minorCount"],
      "properties": {
        "totalViolations": {
          "type": "number",
          "description": "Total number of accessibility violations found"
        },
        "totalPages": {
          "type": "number",
          "description": "Total number of pages tested"
        },
        "criticalCount": {
          "type": "number",
          "description": "Number of critical violations"
        },
        "seriousCount": {
          "type": "number",
          "description": "Number of serious violations"
        },
        "moderateCount": {
          "type": "number",
          "description": "Number of moderate violations"
        },
        "minorCount": {
          "type": "number",
          "description": "Number of minor violations"
        }
      }
    },
    "violations": {
      "type": "array",
      "description": "Detailed list of accessibility violations",
      "items": {
        "type": "object",
        "required": ["id", "impact", "description", "help", "helpUrl", "nodes"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the rule"
          },
          "impact": {
            "type": "string",
            "enum": ["critical", "serious", "moderate", "minor"],
            "description": "Severity level of the violation"
          },
          "description": {
            "type": "string",
            "description": "Description of the accessibility rule"
          },
          "help": {
            "type": "string",
            "description": "Help text for fixing the violation"
          },
          "helpUrl": {
            "type": "string",
            "description": "URL to detailed documentation"
          },
          "tags": {
            "type": "array",
            "description": "WCAG tags and categories",
            "items": {
              "type": "string"
            }
          },
          "nodes": {
            "type": "array",
            "description": "DOM nodes where the violation occurs",
            "items": {
              "type": "object",
              "properties": {
                "html": {
                  "type": "string",
                  "description": "HTML snippet of the violating element"
                },
                "target": {
                  "type": "array",
                  "description": "CSS selector path to the element",
                  "items": {
                    "type": "string"
                  }
                },
                "failureSummary": {
                  "type": "string",
                  "description": "Summary of why this node failed"
                },
                "page": {
                  "type": "string",
                  "description": "URL or path of the page where violation occurred"
                }
              }
            }
          }
        }
      }
    },
    "passes": {
      "type": "array",
      "description": "List of accessibility rules that passed",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        }
      }
    }
  }
}
